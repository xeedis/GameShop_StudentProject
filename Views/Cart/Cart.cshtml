@model GameShop.ViewModel.CartViewModel
    @using GameShop.Infrastructure
@using System.Web

@{
    Layout = null;
}

<!DOCTYPE html>
<html lang="pl">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>GameShop</title>
    <link rel="stylesheet" href="~/Prototype/frontendTemplate/css/global.css">
    <link rel="stylesheet" href="~/Prototype/frontendTemplate/css/cart.css">
    <script src="https://kit.fontawesome.com/cd4d4653a2.js" crossorigin="anonymous"></script>
</head>
<body>
    <table>
        <tr>
            <th>Book</th>
            <th>Quantity</th>
            <th>Sub Total</th>
        </tr>
        @foreach (var cartItem in Model.CartItem)
        {
            <tr id="cart-row-@cartItem.game.GameId">
                <td>
                    <a href=""> </a>
                    <div class="cart-info">
                        <img src="@Url.Content("~/Prototype/frontendTemplate/img/" + cartItem.game.ImageFileName)" alt="">
                        <div>
                            <p>@cartItem.game.GameId</p>

                            <br>
                            <a class="removeBook" data-id="@cartItem.game.GameId" href="#">Remove</a>
                        </div>
                    </div>
                </td>
                <td><span id="cart-quantity-item-@cartItem.game.GameId"><input value="@cartItem.Quantity" readonly></span> </td>
                <td>@String.Format("{0:0.##}", cartItem.Value)</td>
            </tr>
        }


        <tr id="cart-empty-message" @if (Model.CartItem != null && Model.CartItem.Count > 0) { <text > class="hidden" </text> }>

            <td>
                <div class="cart-info">
                    <h1> <br>Your cart is empty </h1>
                </div>
            </td>

        </tr>

    </table>


    <div class="total-price">
        <table>
            <tr>
                <td>Sub Total</td>
                <td><span id="total-price-value">@String.Format("{0:0.##}", Model.TotalPrice)zł</span></td>
            </tr>


        </table>
    </div>


    @if (Model.TotalPrice > 0)
    {
        <div class="button_container">
            <a class="ButtonLink" id="cart-button-pay" href="@Url.Action("Pay","Cart")"></a>
            <button class="btn"><span>Pay</span> </button>
        </div>
    }


    <div class="button_container">
        <a class="ButtonLink" id="cart-button-pay" href="index.htm"> </a>
        <button class="btn2"><span>Conntinue</span></button>

    </div>



    @section Scripts
    {
       
        <script type="text/javascript">
            $(function () {
                $(".removeBook").click(function () {
                    var RecordToDelete = $(this).attr("data-id");

                    if (RecordToDelete != '') {
                        $.post("/Cart/RemoveFromCart", { "bookId": RecordToDelete },
                            function (response) {
                                if (response.NumberItemsToRemove == 0) {
                                    $('#cart-row-' + response.IdItemsToRemove).fadeOut('slow',
                                        function () {
                                            if (response.CartQuantityItem == 0) {
                                                $("#cart-empty-message").removeClass("hidden");
                                            }
                                        });
                                }
                                else {
                                    $('#cart-quantity-item-' + response.IdItemsToRemove).text(response.NumberItemsToRemove);
                                }
                                if (response.CartTotalPrice == 0) {
                                    $('#cart-button-pay').addClass('hidden');
                                    $('#total-price').addClass('invisible');
                                }
                                $('#total-price-value').text(response.CartTotalPrice);
                                $('#cart-heading-quantity-items').text(response.CartQuantityItem);
                            });
                        return false;
                    }
                });
            });
        </script>
    }
    <footer class="footer">
        <p class="footer__paragraph">&copy; 2020 GameShop, <a href="https://github.com/xeedis/GameShop_StudentProject" target="_blank">student project</a></p>
    </footer>
</body>
</html>
